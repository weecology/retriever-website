
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Writing scripts for the EcoData Retriever - EcoData Retriever</title>
	<meta name="author" content="Ethan White">

	
	<meta name="description" content="The EcoData Retriever includes a simple text file format for adding new
datasets. This allows users with no programming experience to quickly
add &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="EcoData Retriever" type="application/atom+xml">
	
	<link rel="canonical" href="http://ecodataretriever.org/scripting.html">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-48073315-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	
	<img src="http://www.gravatar.com/avatar/ea09e950a307e273ef8d85184c49e7d7?s=160" alt="Profile Picture" style="width: 160px;" />
	
</div>
<hgroup>
  <h1><a href="/">EcoData Retriever</a></h1>
  
</hgroup>

<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/download.html">Download</a></li>
  <li><a href="/getting_started.html">Getting Started</a></li>
  <li><a href="/available-data.html">Available Datasets</a></li>
  <li><a href="/cli.html">Command Line</a></li>
  <li><a href="/scripting.html">Adding Datasets</a></li>
  <li><a href="https://github.com/weecology/retriever">GitHub Repository</a></li>
</ul>

</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		
		
		
		
		
		
		
		
		
		
			<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="page">
    
    <h1 class="title">Writing Scripts for the EcoData Retriever</h1>
    
    <div class="entry-content"><p>The EcoData Retriever includes a simple text file format for adding new
datasets. This allows users with no programming experience to quickly
add most standard datasets to the Retriever by specifying the names and
locations of the tables along with additional information about the
configuration of the data. Running custom scripts that are not part of
the Retriever is as easy as adding them to the directory where the
Retriever is being run, or to a subdirectory named &#8220;scripts&#8220;.</p>

<h2>Basic Scripts</h2>

<p>The most basic scripts require only some general metadata about the
dataset, the name of the database and table, and the location of the
table. The basic script structure is as follows:</p>

<pre><code>name: Name of the dataset
description: A brief description of the dataset of ~25 words.
shortname: A one word name for the dataset
table: Name of the table, URL to the table
</code></pre>

<p>The names before the colons tell the Retriever what information is provided to
the right of the colon. The text to the right of the colon should be replaced
with that for the dataset you are adding. For example, the script for adding
Morgan Ernest&rsquo;s mammalian life history dataset from Ecological Archives is
simply:</p>

<pre><code># basic information about the script
name: Mammal Life History Database - Ernest, et al., 2003
shortname: MammalLH
description: S. K. Morgan Ernest. 2003. Life history characteristics of placental non-volant mammals. Ecology 84:3402.
tags: Taxon &gt; Mammals, Data Type &gt; Compilation

# tables
table: species, http://esapubs.org/archive/ecol/E084/093/Mammal_lifehistories_v2.txt
</code></pre>

<ul>
<li>The first line of the script is the full name of the dataset</li>
<li>The second line gives a description of the dataset, in this case the
full citation</li>
<li>The third line gives a short name for the database to be used in
cases where a brief, typically single word description is required,
such as for <a href="cli.html">installing from the command line</a></li>
<li>The forth line provides some optional tags to help with filtering
the data</li>
<li>The last line gives the name for each table (there is only one table
in this case), and its URL</li>
</ul>


<h2>Multiple Tables</h2>

<p>Adding datasets with multiple tables is handled simply by adding more
<code>table:</code> lines to the script. For example, the script for adding
McGlinn et al. 2010 from Ecological Archives is:</p>

<pre><code>name: Vascular plant composition - McGlinn, et al., 2010
description: Daniel J. McGlinn, Peter G. Earls, and Michael W. Palmer. 2010. A 12-year study on the scaling of vascular plant composition in an Oklahoma tallgrass prairie. Ecology 91:1872.
shortname: McGlinn2010
tags: Taxon &gt; Plants, Spatial Scale &gt; Local, Data Type &gt; Time Series, Data Type &gt; Observational

table: pres, http://esapubs.org/archive/ecol/E091/124/TGPP_pres.csv
table: cover, http://esapubs.org/archive/ecol/E091/124/TGPP_cover.csv
table: richness, http://esapubs.org/archive/ecol/E091/124/TGPP_rich.csv
table: species, http://esapubs.org/archive/ecol/E091/124/TGPP_specodes.csv
table: environment, http://esapubs.org/archive/ecol/E091/124/TGPP_env.csv
table: climate, http://esapubs.org/archive/ecol/E091/124/TGPP_clim.csv
</code></pre>

<h2>Null Values</h2>

<p>The Retriever can replace non-standard null values by adding an
additional line to the script with a comma separated list of those null
values after the table in which the null values occur</p>

<pre><code>table: name, url
*nulls: -999, 'NA'
</code></pre>

<p>For example, the Capellini et al. 2010 script uses -9999 to indicate
null values.</p>

<pre><code># Capellini et al. 2010, Ecological Archives, Retriever Script
name: Phylogeny and metabolic rates in mammals (Ecological Archives 2010)
description: Isabella Capellini, Chris Venditti, and Robert A. Barton. 2010. Phylogeny and metabolic rates in mammals. Ecology 20:2783-2793.
shortname: MammalMR2010
tags: Taxon &gt; Mammals, Data Type &gt; Compilation

table: MammalMR2010, http://www.esapubs.org/archive/ecol/E091/198/data.txt
*nulls: -9999
</code></pre>

<h2>Headers</h2>

<p>If the first row of a table is the headers then naming the columns will,
be default, be handled automatically. If you want to rename an existing
header row for some reason, e.g., it includes reserved keywords for a
database management system, you can do so by adding a <code>replace:</code> line
above the tables whose headings should be changed.</p>

<pre><code>table: name of table not requiring heading modification, URL
replace: heading in datafile, new heading; another heading in datafile, new heading
table: name of table to be modified, url
table: name of second table to be modified in the same manner, url
</code></pre>

<p>The script for the Adler et al. 2007 dataset from Ecological Archives
includes this functionality.</p>

<pre><code>name: Kansas plant quadrats (Ecological Archives 2007)
description: Peter B. Adler, William R. Tyburczy, and William K. Lauenroth. 2007. Long-term mapped quadrats from Kansas prairie: demographic information for herbaceaous plants. Ecology 88:2673.
shortname: Adler2007
tags: Taxon &gt; Plants, Spatial Scale &gt; Local, Data Type &gt; Time Series, Data Type &gt; Observational
url: http://esapubs.org/archive/ecol/E088/161/

table: main, http://esapubs.org/archive/ecol/E088/161/allrecords.csv
table: quadrat_info, http://esapubs.org/archive/ecol/E088/161/quadrat_info.csv
table: quadrat_inventory, http://esapubs.org/archive/ecol/E088/161/quadrat_inventory.csv
*nulls: 'NA'
table: species, http://esapubs.org/archive/ecol/E088/161/species_list.csv

replace: jan, january; feb, february; mar, march; apr, april; jun, june; jul, july; aug, august; sep, september; oct, october; nov, november; dec, december
table: monthly_temp, http://esapubs.org/archive/ecol/E088/161/monthly_temp.csv
*nulls: 'NA'
table: monthly_ppt, http://esapubs.org/archive/ecol/E088/161/monthly_ppt.csv
*nulls: 'NA'
</code></pre>

<h2>Full control over column names and data types</h2>

<p>By default the Retriever automatically detects both column names and data types,
but you can also exercise complete control over the structure of the resulting
database by adding <code>*column:</code> lines after a table.</p>

<pre><code>table: name, url
*column: Name for 1st column, type, type details (e.g. max string length)
*column: Name for 2nd column, type, type details
</code></pre>

<p>The Smith et al. Masses of Mammals dataset script includes this type of
functionality.</p>

<pre><code>name: Masses of Mammals (Ecological Archives 2003)
description: Felisa A. Smith, S. Kathleen Lyons, S. K. Morgan Ernest, Kate E. Jones, Dawn M. Kaufman, Tamar Dayan, Pablo A. Marquet, James H. Brown, and John P. Haskell. 2003. Body mass of late Quaternary mammals. Ecology 84:3403.
shortname: MoM2003
tags: Taxon &gt; Mammals, Data Type &gt; Compilation
url: http://www.esapubs.org/archive/ecol/E084/094/

table: MOM, http://www.esapubs.org/Archive/ecol/E084/094/MOMv3.3.txt
*nulls: -999
*column: record_id, pk-auto
*column: continent, char, 20
*column: status, char, 20
*column: sporder, char, 20
*column: family, char, 20
*column: genus, char, 20
*column: species, char, 20
*column: log_mass_g, double
*column: comb_mass_g, double
*column: reference, char
</code></pre>

<h2>Restructuring cross-tab data</h2>

<p>It is common in ecology to see data where the rows indicate one level of
grouping (e.g., by site), the columns indicate another level of grouping (e.g.,
by species), and the values in each cell indicate the value for the group
indicated by the row and column (e.g., the abundance of species x at site
y). This is referred as cross-tab data and cannot be easily handled by database
management systems, which are based on a one record per line structure. The
Retriever can restructure this type of data into the appropriate form. In
scripts this involves telling the retriever the name of the column to store the
data in and the names of the columns to be restructured.</p>

<pre><code>table: name, url
*column: name of regular column, type
*column: another regular column name, type
*ct_column: name of column to store cross-tab data
*ct_names: name of crosstab column 1, name of CT col 2, name of CT col 3
</code></pre>

<p>The del Moral Mount St. Helens script takes advantage of this
functionality.</p>

<pre><code>name: Vegetation plots - del Moral, 2010
description: Roger del Moral. 2010. Thirty years of permanent vegetation plots, Mount St. Helens, Washington. Ecology 91:2185.
shortname: DelMoral2010
tags: Taxon &gt; Plants, Spatial Scale &gt; Local, Data Type &gt; Time Series, Data Type &gt; Observational

table: species_plot_year, http://esapubs.org/archive/ecol/E091/152/MSH_SPECIES_PLOT_YEAR.csv
*delimiter: ','
*column: record_id, pk-auto
*column: plot_id_year, char, 20
*column: plot_name, char, 4
*column: plot_number, int
*column: year, int
*column: count, ct-double
*ct_column: species
*ct_names: Abilas,Abipro,Achmil,Achocc,Agoaur,Agrexa,Agrpal,Agrsca,Alnvir,Anamar,Antmic,Antros,Aqifor,Arcnev,Arnlat,Astled,Athdis,Blespi,Brocar,Brosit,Carmer,Carmic,Carpac,Carpay,Carpha,Carros,Carspe,Casmin,Chaang,Cirarv,Cisumb,Crycas,Danint,Descae,Elyely,Epiana,Eriova,Eripyr,Fesocc,Fravir,Gencal,Hiealb,Hiegra,Hyprad,Junmer,Junpar,Juncom,Leppun,Lommar,Luepec,Luihyp,Luplat,Luplep,Luzpar,Maiste,Pencar,Pencon,Penser,Phahas,Phlalp,Phldif,Phyemp,Pincon,Poasec,Poldav,Polmin,Pollon,Poljun,Popbal,Potarg,Psemen,Raccan,Rumace,Salsit,Saxfer,Senspp,Sibpro,Sorsit,Spiden,Trispi,Tsumer,Vacmem,Vervir,Vioadu,Xerten

table: structure_plot_year, http://esapubs.org/archive/ecol/E091/152/MSH_STRUCTURE_PLOT_YEAR.csv
table: species, http://esapubs.org/archive/ecol/E091/152/MSH_SPECIES_DESCRIPTORS.csv
*escape_single_quotes: True
table: plots, http://esapubs.org/archive/ecol/E091/152/MSH_PLOT_DESCRIPTORS.csv
</code></pre>
</div>
</article>


</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2014 - Ethan White -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





		</div>
	</div>
</body>
</html>
